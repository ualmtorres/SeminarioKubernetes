<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Cloud-DI Team - Departamento de InformÃ¡tica. UAL">
<title>Kubernetes</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Kubernetes</h1>
<div class="details">
<span id="author" class="author">Cloud-DI Team - Departamento de InformÃ¡tica. UAL</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de contenidos</div>
<ul class="sectlevel1">
<li><a href="#trueresumen">Resumen</a></li>
<li><a href="#trueintroducci-n">1. IntroducciÃ³n</a></li>
<li><a href="#trueconceptos-b-sicos">2. Conceptos bÃ¡sicos</a>
<ul class="sectlevel2">
<li><a href="#truecluster-de-kubernetes">2.1. Cluster de Kubernetes</a></li>
<li><a href="#trueobjetos-de-kubernetes">2.2. Objetos de Kubernetes</a></li>
</ul>
</li>
<li><a href="#Minikube">3. Minikube</a>
<ul class="sectlevel2">
<li><a href="#true-code-kubectl-code-el-cli-para-kubernetes">3.1. <code>kubectl</code> el CLI para Kubernetes</a></li>
</ul>
</li>
<li><a href="#truedeployments">4. Deployments</a>
<ul class="sectlevel2">
<li><a href="#truedespliegue-de-una-aplicaci-n">4.1. Despliegue de una aplicaciÃ³n</a></li>
</ul>
</li>
<li><a href="#truepods">5. Pods</a></li>
<li><a href="#truenodos">6. Nodos</a></li>
<li><a href="#trueservicios">7. Servicios</a>
<ul class="sectlevel2">
<li><a href="#trueejemplo-creaci-n-de-un-servicio">7.1. Ejemplo. CreaciÃ³n de un servicio</a></li>
</ul>
</li>
<li><a href="#trueescalado-de-una-aplicaci-n">8. Escalado de una aplicaciÃ³n</a>
<ul class="sectlevel2">
<li><a href="#trueejemplo-de-escalado-de-una-aplicaci-n">8.1. Ejemplo de escalado de una aplicaciÃ³n</a></li>
</ul>
</li>
<li><a href="#trueactualizaci-n-de-aplicaciones">9. ActualizaciÃ³n de aplicaciones</a></li>
<li><a href="#trueap-ndice-cheat-sheet">10. ApÃ©ndice. Cheat Sheet</a>
<ul class="sectlevel2">
<li><a href="#trueminikube">10.1. Minikube</a></li>
<li><a href="#true-code-kubectl-code">10.2. <code>kubectl</code></a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/di.png" alt="di.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueresumen"><a class="anchor" href="#trueresumen"></a>Resumen</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TRABAJO EN CURSO</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Objetivos</div>
<p>*</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Disponibles los repositorios usados en este seminario:</p>
</div>
<div class="paragraph">
<p>*</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueintroducci-n"><a class="anchor" href="#trueintroducci-n"></a>1. IntroducciÃ³n</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La adopciÃ³n de Docker sigue creciendo de forma imparable y cada vez mÃ¡s organizaciones lo usan en producciÃ³n. Por tanto, se hace necesario contar con una plataforma de orquestaciÃ³n que permita administrar y escalar los contenedores.</p>
</div>
<div class="paragraph">
<p>Supongamos que hemos comenzado a usar Docker y hemos hecho un despliegue de un par de servidores. De pronto, la aplicaciÃ³n comienza a tener un gran trÃ¡fico de entrada y hay que escalar a una gran cantidad de servidores para atender la demanda. AquÃ­ es donde entra Kubernetes para hacer tareas del tipo <em>dÃ³nde debe ir un contenedor, cÃ³mo se monitorizan esos contenedores</em> o <em>cÃ³mo se reinician cuando tengan un problema</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueconceptos-b-sicos"><a class="anchor" href="#trueconceptos-b-sicos"></a>2. Conceptos bÃ¡sicos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes es una plataforma de cÃ³digo abierto para despliegue automÃ¡tico, escalado y gestiÃ³n de aplicaciones contenedorizadas. Kubernetes ofrece una abstracciÃ³n en la que permite el despliegue de aplicaciones en un cluster sin pensar en las mÃ¡quinas que lo soportan.</p>
</div>
<div class="sect2">
<h3 id="truecluster-de-kubernetes"><a class="anchor" href="#truecluster-de-kubernetes"></a>2.1. Cluster de Kubernetes</h3>
<div class="paragraph">
<p>Un cluster de Kubernetes estÃ¡ formado por dos tipos de recursos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El <strong>Master</strong> coordina el cluster. Coordina todas las actividades del cluster como organizar las aplicaciones, mantener el estado deseado de las aplicaciones, escalado, despliegue de actualizaciones, y demÃ¡s.</p>
</li>
<li>
<p>Los <strong>Nodos</strong> son <em>workers</em> que ejecutan las aplicaciones. Cada nodo contiene un agente denominado <em>Kubelet</em> que gestiona el nodo y mantiene la comunicaciÃ³n con el MÃ¡ster. El nodo tambiÃ©n tiene herramientas para trabajar con contenedores, como Docker.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Un cluster Kubernetes en producciÃ³n deberÃ­a tener al menos 3 nodos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesCluster.svg" alt="KubernetesCluster.svg">
</div>
</div>
<div class="paragraph">
<p>Al desplegar una aplicaciÃ³n en Kubernetes el Master inicia los contenedores de la aplicaciÃ³n. El mÃ¡ster organiza los contenedores para que se ejecuten en los nodos del cluster. Los nodos se comunican con el master usando la <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.15/#-strong-api-overview-strong-">API de Kubernetes</a>. La API es expuesta a travÃ©s del nodo Master y es posible usarla directamente para intectuar con el cluster.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Lista de pods usando la API de Kubernetes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ curl http://&lt;kubernetes_home&gt;/api/v1/namespaces/default/pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
  "kind": "PodList",
  "apiVersion": "v1",
  "metadata": {
    "selfLink": "/api/v1/namespaces/default/pods",
    "resourceVersion": "10803"
  },
  "items": [
    {
      "metadata": {
        "name": "hello-minikube-64c7df9db-ffwtn",
        "generateName": "hello-minikube-64c7df9db-",
        "namespace": "default",
        "selfLink": "/api/v1/namespaces/default/pods/hello-minikube-64c7df9db-ffwtn",
        "uid": "652c298a-6dc2-4aec-a72f-390669fed6d2",
        "resourceVersion": "10608",
        "creationTimestamp": "2019-07-08T18:02:23Z",
        "labels": {
          "pod-template-hash": "64c7df9db",
          "run": "hello-minikube"
        },
....</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Los clusters de Kubernetes se pueden desplegar sobre mÃ¡quinas fÃ­sicas o virtuales. Para comenzar a practicar con Kubernetes o para tareas de desarrollo, <a href="https://github.com/kubernetes/minikube">Minikube</a> es una buena opciÃ³n. En la secciÃ³n <a href="#Minikube">Minikube</a> se presenta mÃ¡s informaciÃ³n sobre esta plataforma. Minikube estÃ¡ disponible para Windows, Linux y MacOS.</p>
</div>
</div>
<div class="sect2">
<h3 id="trueobjetos-de-kubernetes"><a class="anchor" href="#trueobjetos-de-kubernetes"></a>2.2. Objetos de Kubernetes</h3>
<div class="paragraph">
<p>Kubernetes ofrece una serie de objetos bÃ¡sicos y una serie de abstracciones de nivel superior llamadas Controladores. Los Controladores se basan en los objetos bÃ¡sicos y proporcionan funcionalidades adicionales sobre los objetos bÃ¡sicos</p>
</div>
<div class="paragraph">
<p>Los objetos bÃ¡sicos de Kubernetes son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod</p>
</li>
<li>
<p>Service</p>
</li>
<li>
<p>Volume</p>
</li>
<li>
<p>Namespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los objetos de nivel superior o Controladores se basan en los objetos bÃ¡sicos y ofrecen funcionalidades adicionales sobre los objetos bÃ¡sicos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ReplicaSet</p>
</li>
<li>
<p>Deployment</p>
</li>
<li>
<p>StatefulSet</p>
</li>
<li>
<p>DaemonSet</p>
</li>
<li>
<p>Job</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Minikube"><a class="anchor" href="#Minikube"></a>3. Minikube</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Minikube es una implementaciÃ³n ligera de Kubernetes que crea una mÃ¡quina virtual localmente y despliega un cluster sencillo formado por un solo nodo.</p>
</li>
<li>
<p>Minikube es una gran herramienta para el desarrollo de aplicaciones Kubernetes y permite caracterÃ­sticas habituales como <em>LoadBalancer</em>, <em>NodePort</em>, volÃºmenes persistentes, <em>Ingress</em>, dashboard, reglas de acceso, y demÃ¡s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la <a href="https://github.com/kubernetes/minikube">pÃ¡gina de GitHub de Minikube</a> se encuentra informaciÃ³n sobre el proyecto, <a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">instalaciÃ³n</a> y otros temas de interÃ©s.</p>
</div>
<div class="paragraph">
<p>Una vez instalado, probaremos los comandos bÃ¡sicos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Iniciar un cluster: <code>minikube start</code> (La primera vez que ejecutemos este comando descargarÃ¡ la ISO de Minikube, que son unos 130 MB, y crearÃ¡ la mÃ¡quina virtual correspondiente)</p>
</li>
<li>
<p>Acceso al Dashboard de Kubernetes: <code>minikube dashboard</code></p>
</li>
<li>
<p>Una vez iniciado, se podrÃ¡ interactuar con el cluster usando <code>kubectl</code> (que veremos en la secciÃ³n <a href="#kubectl el CLI para Kubernetes">[kubectl el CLI para Kubernetes]</a>) como con cualquier cluster Kubernetes:</p>
<div class="ulist">
<ul>
<li>
<p>Iniciar un servidor: <code>kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.4 --port=8080</code></p>
</li>
<li>
<p>Exponer un servicio como un <em>NodePort</em>: <code>kubectl expose deployment hello-minikube --type=NodePort</code></p>
</li>
<li>
<p>Abrir el endpoint del servicio en el navegador: <code>minikube service hello-minikube</code></p>
<div class="paragraph">
<p>El servidor de ejemplo iniciado muestra informaciÃ³n sobre el cliente en el que se estÃ¡ ejecutando y sobre las cabeceras. Dicho servidor es expuesto en el cluster de Kubernetes como un <em>NodePort</em>. El resultado tras mostrarlo con <code>minikube service hello-minikube</code> serÃ¡ algo similar al de la figura siguiente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SampleKubernetesService.png" alt="SampleKubernetesService.png">
</div>
</div>
<div class="paragraph">
<p>Si ahora abrimos el dashboard, se mostrarÃ­a algo similar a lo de la figura siguiente. En la figura se observa cÃ³mo ha sido creado el Deployment <code>hello-minikube</code>.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesDashboard.png" alt="KubernetesDashboard.png">
</div>
</div>
</li>
<li>
<p>Iniciar un segundo cluster local: <code>minikube start -p cluster2</code></p>
</li>
<li>
<p>Detener el cluster local: <code>minikube stop</code></p>
</li>
<li>
<p>Eliminar el cluster local: <code>minikube delete</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="true-code-kubectl-code-el-cli-para-kubernetes"><a class="anchor" href="#true-code-kubectl-code-el-cli-para-kubernetes"></a>3.1. <code>kubectl</code> el CLI para Kubernetes</h3>
<div class="paragraph">
<p>Para la interacciÃ³n con un cluster local o remoto de Kubernetes mediante comandos se usa <code>kubectl</code>, un CLI sencillo que nos permitirÃ¡ realizar tareas habituales como despliegues, escalar el cluster u obtener informaciÃ³n sobre los servicios en ejecuciÃ³n.</p>
</div>
<div class="paragraph">
<p>Consultar la <a href="https://kubernetes.io/es/docs/tasks/tools/install-kubectl/#instalar-kubectl">pÃ¡gina oficial de instalaciÃ³n y configuraciÃ³n de <code>kubectl</code></a></p>
</div>
<div class="paragraph">
<p>Para interactuar con unos ejemplos sencillo con <code>kubectl</code> podemos</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtener informaciÃ³n de la versiÃ³n</p>
</li>
<li>
<p>Obtener informaciÃ³n del cluster</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
KubeDNS is running at https://192.168.99.100:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</code></pre>
</div>
</div>
</li>
<li>
<p>Obtener los nodos que forman el cluster</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME       STATUS   ROLES    AGE     VERSION
minikube   Ready    master   3d23h   v1.15.0</code></pre>
</div>
</div>
</li>
<li>
<p>Otras operaciones de interÃ©s son:</p>
<div class="ulist">
<ul>
<li>
<p><code>kubectl describe <a href="#resource">[resource]</a></code> para obtener informaciÃ³n detallada sobre un recurso.</p>
</li>
<li>
<p><code>kubectl logs <a href="#pod">[pod]</a></code> para mostrar los logs de un contenedor en un pod.</p>
</li>
<li>
<p><code>kubectl exec <a href="#pod">[pod]</a> <a href="#command">[command]</a></code> para ejecutar un comando en un contenedor de un pod.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truedeployments"><a class="anchor" href="#truedeployments"></a>4. Deployments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Una configuraciÃ³n de Deployment pide a Kubernetes que cree y actualice las instancias de una aplicaciÃ³n. Tras crear el Deployment, el Master organiza las instancias de aplicaciÃ³n en los nodos disponibles del cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesDeployment.svg" alt="KubernetesDeployment.svg">
</div>
</div>
<div class="paragraph">
<p>Una vez creadas las instancias de aplicaciÃ³n, el <strong>Controlador de Deployment de Kubernetes</strong> monitoriza continuamente las instancias. Si un nodo en el que estÃ¡ una instancia cae o es eliminado, el Controlador de Deployment de Kubernetes sustituye la instancia por otra instancia en otro nodo disponible del cluster.</p>
</div>
<div class="paragraph">
<p>Esta funcionalidad de <em>autocuraciÃ³n</em> de las aplicaciones supone un cambio radical en la gestiÃ³n de las aplicaciones. Esta caracterÃ­stica de recuperaciÃ³n de fallos mediante la creaciÃ³n de nuevas instancias que reemplazan a las defectuosas o desaparecidas no existÃ­a antes de los orquestadores.</p>
</div>
<div class="paragraph">
<p>Al crear un Deployment se especifica la imagen del contenedor que usarÃ¡ la aplicaciÃ³n y el nÃºmero de rÃ©plicas que se quieren mantener en ejecuciÃ³n. El nÃºmero de rÃ©plicas se puede modificar en cualquier momento actualizando el Deployment.</p>
</div>
<div class="sect2">
<h3 id="truedespliegue-de-una-aplicaci-n"><a class="anchor" href="#truedespliegue-de-una-aplicaci-n"></a>4.1. Despliegue de una aplicaciÃ³n</h3>
<div class="paragraph">
<p>Podemos ejecutar una aplicaciÃ³n con <code>kubectl run</code> indicando el nombre que se darÃ¡ al Deployment y el nombre de la imagen (Docker) usada para la aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl run jsonproducer --image=ualmtorres/jsonproducer:v0 --port 80 <i class="conum" data-value="1"></i><b>(1)</b>

deployment.apps/jsonproducer created</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El puerto hace referencia al puerto que usa la aplicaciÃ³n original para servir su contenido.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Esto ha hecho que el Master haya buscado un nodo para ejecutar la aplicaciÃ³n, haya programado la ejecuciÃ³n de la aplicaciÃ³n en ese nodo y haya configurado el cluster para programar la ejecuciÃ³n de otra instancia cuando sea necesario.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para imÃ¡genes que no estÃ©n en Docker Hub se pasa la URL completa del repositorio de imÃ¡genes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para obtener los Deployments disponibles</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get deployments

NAME           READY   UP-TO-DATE   AVAILABLE   AGE
jsonproducer   1/1     1            1           8s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poder acceder a la aplicaciÃ³n deberemos primero exponerla en el cluster de Kubernetes. MÃ¡s adelante veremos los detalles. Por ahora, basta con ejecutar el comando siguiente, el cual crearÃ¡ un <em>servicio</em> asociado a nuestro Deployment para poder acceder a la aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl expose deployment jsonproducer --type=NodePort

service/jsonproducer exposed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para ver la ejecuciÃ³n de la aplicaciÃ³n, pediremos a Minikube que nos muestre el <em>servicio</em> con el comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ minikube service jsonproducer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto abrirÃ¡ un navegador y el resultado del servicio es un JSON similar a este:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{"nombre":"manolo"}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truepods"><a class="anchor" href="#truepods"></a>5. Pods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Al crear el Deployment anterior, Kubernetes creÃ³ un Pod para ejecutar la instancia de la aplicaciÃ³n. Un Pod es una abstracciÃ³n de Kubernetes que representa un grupo de uno o mÃ¡s contenedores de una aplicaciÃ³n y algunos recursos compartidos de esos contenedores (p.e. volÃºmenes, redes)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Un ejemplo de pod con mÃ¡s de un contenedor lo encontramos en lo que se denominan <em>sidecars</em>. Ejemplos de sidecar los encontramos en aplicaciones que registran su actividad en un contenedor (sidecar) dentro del mismo pod y publican la actividad en una aplicaciÃ³n que monitoriza el cluster. Otro ejemplo de sidecar es el de un contenedor sidecar que proporciona un certificado SSL para comunicaciÃ³n https al contenedor de la aplicaciÃ³n.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los contenedores de un pod comparten una IP y un espacio de puertos, y siempre van juntos y se despliegan juntos en un nodo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesPod.svg" alt="KubernetesPod.svg">
</div>
</div>
<div class="paragraph">
<p>Los pods son la unidad atÃ³mica de Kubernetes. Al crear un despliegue en Kubernetes, el Deployment crea Pods con contenedores en su interior. Cada pod queda ligado a un nodo y sigue allÃ­ hasta que se finalice o se elimine. En caso de fallo del nodo se planifica la creaciÃ³n de sus pods en otros nodos disponibles del cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truenodos"><a class="anchor" href="#truenodos"></a>6. Nodos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Los pods se ejecutan en un Nodo. Un nodo es una mÃ¡quina <em>worker</em> (fÃ­sica o virtual) del cluster. Los nodos estÃ¡n gestionados por el Master. Un Nodo puede contener muchos pods.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesNode.svg" alt="KubernetesNode.svg">
</div>
</div>
<div class="paragraph">
<p>Cada Nodo ejecuta al menos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubelet, un proceso que se encarga de la comunicaciÃ³n entre el nodo y el Master. Gestiona los pods y los contenedores que se estÃ¡n ejecutando en el nodo.</p>
</li>
<li>
<p>Un motor de contenedores, como Docker, que se encarga de la descarga de imÃ¡genes de un registro y de ejecutar la aplicaciÃ³n.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueservicios"><a class="anchor" href="#trueservicios"></a>7. Servicios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Se dice que en Kubernetes los pods son mortales. Cuando un nodo desaparece (bien por un error o por una desconexiÃ³n), los contenedores que estÃ¡n en el nodo tambiÃ©n se pierden. A continuaciÃ³n, un <em>ReplicaSet</em> se encarga de devolver al cluster al estado deseado y organiza la creaciÃ³n de nuevos pods en otros nodos disponibles para mantener funcionando la aplicaciÃ³n. Las rÃ©plicas de los pods han de ser intercambiables y <strong>aunque cada pod en el cluster tenga su propia IP Ãºnica, Kubernetes reconcialiarÃ¡ los cambios entre los pods para que las aplicaciones sigan funcionando</strong>.</p>
</div>
<div class="paragraph">
<p>Los servicios en Kubernetes son una abstracciÃ³n que definen un conjunto lÃ³gico de pods y una polÃ­tica de acceso a ellos. Esto permite que haya un acoplamiento dÃ©bil entre pods dependientes. De esta forma, las aplicaciones sÃ³lo usarÃ¡n los nombres de los servicios y no las IP de los pods, ya que Ã©stas nunca son fijas debido a que, por un lado, los pods se crean y se destruyen para mantener el nÃºmero de rÃ©plicas deseado; y por otro lado, un pod puede ser sustituido por otro ante un problema y el nuevo pod tendrÃ¡ una IP diferente.</p>
</div>
<div class="paragraph">
<p>Cada pod tiene una direcciÃ³n IP Ãºnica, pero esa IP no se expone fuera del cluster sin lo que se denomina un Servicio. Los servicios pemiten que las aplicaciones reciban trÃ¡fico. En funciÃ³n del Ã¡mbito de la exposiciÃ³n del servicio tenemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClusterIP: El servicio recibe una IP interna a nivel de cluster y hace que el servicio sÃ³lo sea accesible a nivel de cluster.</p>
</li>
<li>
<p>NodePort: Expone el servicio fuera del cluster concatenando la IP del nodo en el que estÃ¡ el pod y un nÃºmero de puerto entre 30000 y 32767, que es el mismo en todos los nodos</p>
</li>
<li>
<p>LoadBalancer: Crea en cloud, si es posible, un balanceador externo con una IP externa asignada.</p>
</li>
<li>
<p>ExternalName: Expone el servicio usando un nombre arbitrario (especificado en <code>externalName</code>)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesService.svg" alt="KubernetesService.svg">
</div>
</div>
<div class="paragraph">
<p>Los servicios enrutan el trÃ¡fico entre los pods proporcionando una abstracciÃ³n que permite que los pod mueran y se repliquen sin impactar en la aplicaciÃ³n. El descubrimiento y enrutado entre pods dependientes (p.e. frontend y backend) son gestionados por los Servicios.</p>
</div>
<div class="paragraph">
<p>Los servicios agrupan a sus pods usando etiquetas y selectores. Las etiquetas son pares clave-valor y tienen usos muy variados:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Diferenciar entre objetos de desarrollo, prueba y producciÃ³n</p>
</li>
<li>
<p>Distinguir entre versiones</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesLabels.svg" alt="KubernetesLabels.svg">
</div>
</div>
<div class="paragraph">
<p>En la figura se observa cÃ³mo el selector de etiquetas usado en los Deployment sirve para agrupar los pods que conforman un servicio, ya que cada pod contiene la misma etiqueta usada en el selector del Deployment al que pertenece.</p>
</div>
<div class="paragraph">
<p>Las etiquetas se pueden configurar durante la creaciÃ³n o en cualquier momento posterior.</p>
</div>
<div class="sect2">
<h3 id="trueejemplo-creaci-n-de-un-servicio"><a class="anchor" href="#trueejemplo-creaci-n-de-un-servicio"></a>7.1. Ejemplo. CreaciÃ³n de un servicio</h3>
<div class="paragraph">
<p>Anteriormente, en la secciÃ³n <a href="#truedespliegue-de-una-aplicaci-n">Despliegue de una aplicaciÃ³n</a> creamos una aplicaciÃ³n de ejemplo que generaba un JSON de prueba. A modo de recordatorio, hicimos lo siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear un Deployment a partir de la imagen <code>ualmtorres/jsonproducer:v0</code> de Docker Hub con el comando</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl run jsonproducer --image=ualmtorres/jsonproducer:v0 --port 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos consultar el Deployment existente con el comando siguiente. Si por cualquier motivo no se dispone del Deployment, basta con ejecutar el comando anterior para crearlo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">$ kubectl get deployments
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
jsonproducer   1/1     1            1           17m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este Deployment habrÃ¡ creado un pod que estarÃ¡ ejecutando la aplicaciÃ³n disponible de la imagen utilizada. Podemos ver los pods disponibles con el comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-2nzt2   1/1     Running   0          23m</code></pre>
</div>
</div>
</li>
<li>
<p>Crear un servicio para poder exponer la aplicaciÃ³n al exterior. Concretamente usamos un servicio de tipo NodePort, lo que nos sirve la aplicaciÃ³n concatenando la IP del nodo donde estÃ¡ el pod y un puerto aleatorio. El servicio lo creamos con</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl expose deployment jsonproducer --type=NodePort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos consultar el servicio existente con el comando siguiente. Si por cualquier motivo no se dispone del servicio, basta con ejecutar el comando anterior para crearlo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get services
NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
jsonproducer   NodePort    10.99.116.165   &lt;none&gt;        80:30737/TCP   25m <i class="conum" data-value="1"></i><b>(1)</b>
kubernetes     ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        34d <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Este es nuestro servicio. En el caso del tutorial, el puerto aleatorio asignado es el 30737</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Servicio <code>kubernetes</code> creado de forma predetermianda al iniciarse Minikube</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Podemos acceder el servicio creado con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ minikube service jsonproducer</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesRunningService.png" alt="KubernetesRunningService.png">
</div>
</div>
<div class="paragraph">
<p>Si queremos consultar la informaciÃ³n del servicio creado usaremos la opciÃ³n <code>describe</code> de <code>kubectl</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl describe services jsonproducer <i class="conum" data-value="1"></i><b>(1)</b>

Name:                     jsonproducer
Namespace:                default
Labels:                   run=jsonproducer <i class="conum" data-value="2"></i><b>(2)</b>
Annotations:              &lt;none&gt;
Selector:                 run=jsonproducer
Type:                     NodePort
IP:                       10.99.116.165
Port:                     &lt;unset&gt;  80/TCP
TargetPort:               80/TCP
NodePort:                 &lt;unset&gt;  30737/TCP
Endpoints:                172.17.0.5:80
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pasamos el nombre de nuestro servicio como parÃ¡metro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Etiqueta aÃ±adida de forma predeterminada</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si ahora consultamos la informaciÃ³n del pod de la aplicaciÃ³n veremos que coincide la etiqueta. Recordemos que al introducir el concepto de Servicio se indicÃ³ que era una abstracciÃ³n para agrupar pods y que utilizaba etiquetas para poder reunirlos. He aquÃ­ la correspondencia entre la etiqueta del servicio y la etiqueta de los pods del servicio.</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods <i class="conum" data-value="1"></i><b>(1)</b>

NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-2nzt2   1/1     Running   0          49m

$ kubectl describe pods jsonproducer-7769d76894-2nzt2 <i class="conum" data-value="2"></i><b>(2)</b>

Name:               jsonproducer-7769d76894-2nzt2
Namespace:          default
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               minikube/10.0.2.15
Start Time:         Mon, 15 Jul 2019 18:56:20 +0200
Labels:             pod-template-hash=7769d76894
                    run=jsonproducer <i class="conum" data-value="3"></i><b>(3)</b>
Annotations:        &lt;none&gt;
Status:             Running
IP:                 172.17.0.5
Controlled By:      ReplicaSet/jsonproducer-7769d76894 <i class="conum" data-value="4"></i><b>(4)</b>
Containers:
  jsonproducer:
    Container ID:   docker://52e290262984a94da4dd89102b93d80f59c0c4310c303dac67b02884d73fb545
    Image:          ualmtorres/jsonproducer:v0 <i class="conum" data-value="5"></i><b>(5)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtener primero los pods disponibles para poder acceder al pod deseado</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtener informaciÃ³n del pod</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Etiqueta coincidente con el selector (etiqueta) del Deployment</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ReplicaSet encargado de mantener el nÃºmero de pods deseados para el Deployment</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Imagen base usada para crear el Ãºnico contenedor de este pod</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueescalado-de-una-aplicaci-n"><a class="anchor" href="#trueescalado-de-una-aplicaci-n"></a>8. Escalado de una aplicaciÃ³n</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hasta ahora hemos creado un Deployment que posteriomente ha sido expuesto mediante un Servicio. Como no indicamos nÃºmero de rÃ©plicas, el Deployment creÃ³ sÃ³lo un Pod para ejecutar la aplicaciÃ³n. Si la demanda aumenta quizÃ¡ puede llegar a ser necesario aumentar el nÃºmero de pods de la aplicaciÃ³n. Esto es lo que se conoce como escalado y hace referencia al nÃºmero de rÃ©plicas en un Deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para escalar un Deployment durante la creaciÃ³n se usa el parÃ¡metro <code>--replicas=<a href="#numero-de-replicas">[numero-de-replicas]</a></code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Al escalar una aplicaciÃ³n se crearÃ¡n nuevos pods en los nodos con recursos disponibles e irÃ¡ aumentando hasta llegar al nÃºmero de pods deseados. La ejecuciÃ³n de varias instancias trae consigo la distribuciÃ³n del trÃ¡fico entre todos los pods del Deployment. De esta tarea se encarga un balanceador de carga que integra el propio Servicio.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Escalar a 0 terminarÃ¡ todos los pods de un Deployment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez que entramos en la dinÃ¡mica de tener varias instancias de la misma aplicaciÃ³n, se pueden tener actualizaciones en caliente (<em>rolling updates</em>) sin suspensiÃ³n del servicio. Esto lo veremos en la secciÃ³n <a href="#trueactualizaci-n-de-aplicaciones">ActualizaciÃ³n de aplicaciones</a>.</p>
</div>
<div class="sect2">
<h3 id="trueejemplo-de-escalado-de-una-aplicaci-n"><a class="anchor" href="#trueejemplo-de-escalado-de-una-aplicaci-n"></a>8.1. Ejemplo de escalado de una aplicaciÃ³n</h3>
<div class="paragraph">
<p>En primer lugar veremos cuÃ¡les eran las condiciones del despliegue de ejemplo que estamos usando.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get deployments

NAME           READY   UP-TO-DATE   AVAILABLE   AGE
jsonproducer   1/1     1            1           68m</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READY</code> indica el ratio entre los pods deseados y los que estÃ¡n en ejecuciÃ³n.</p>
</li>
<li>
<p><code>UP-TO-DATE</code> indica el nÃºmero de rÃ©plicas que estÃ¡n actualizadas para alcanzar el estado deseado.</p>
</li>
<li>
<p><code>AVAILABLE</code> indica el nÃºmero de rÃ©plicas disponibles actualmente para los usuarios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El comando siguiente escala a 4 rÃ©plicas el despliegue de ejemplo (<code>jsonproducer</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl scale deployments jsonproducer --replicas=4

deployment.extensions/jsonproducer scaled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unos instantes despuÃ©s podremos comprobar que el Deployment ya ha alcanzado el estado deseado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get deployments

NAME           READY   UP-TO-DATE   AVAILABLE   AGE
jsonproducer   4/4     4            4           73m</code></pre>
</div>
</div>
<div class="paragraph">
<p>La aplicaciÃ³n sigue disponible sin ningÃºn cambio para el usuario final. Sin embargo, ahora hay 4 rÃ©plicas cuyo trÃ¡fico es gestionado por un balanceador de carga asociado al servicio.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesRunningService.png" alt="KubernetesRunningService.png">
</div>
</div>
<div class="paragraph">
<p>La informaciÃ³n de las rÃ©plicas la podemos obtener consultando el nÃºmero de pods con el comando siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods

NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-2nzt2   1/1     Running   0          74m
jsonproducer-7769d76894-9xdqw   1/1     Running   0          38s
jsonproducer-7769d76894-nhtl4   1/1     Running   0          38s
jsonproducer-7769d76894-qbvzd   1/1     Running   0          38s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora por cualquier motivo dejase de estar disponible alguno de los nodos en los que se encuentra desplegados los pods de la apliaciÃ³n, o bien dejase de funcionar alguno de los pods, el Controlador de Deployment de Kubernetes se encargarÃ­a de organizar la creaciÃ³n de nuevos pods para volver a alcanzar el estado deseado, en nuestro caso 4 rÃ©plicas.</p>
</div>
<div class="paragraph">
<p>Probemos esta funcionalidad eliminando el Ãºltimo pod y comprobando como Kubernetes organiza inmediatamente la creaciÃ³n de otro pod que lo sustituya.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl delete pods jsonproducer-7769d76894-qbvzd
pod "jsonproducer-7769d76894-qbvzd" deleted

$ kubectl get pods
NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-2nzt2   1/1     Running   0          85m
jsonproducer-7769d76894-9xdqw   1/1     Running   0          12m
jsonproducer-7769d76894-gh7qk   1/1     Running   0          3s <i class="conum" data-value="1"></i><b>(1)</b>
jsonproducer-7769d76894-nhtl4   1/1     Running   0          12m</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pod que sustituye al pod eliminado creado automÃ¡ticamente para mantener el nÃºmero de rÃ©plicas a 4</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por Ãºltimo, si ahora queremos reducir el nÃºmero de rÃ©plicas a 2 bastarÃ¡ con volver a indicarlo al Deployment en el parÃ¡metro <code>replicas</code> y este serÃ¡ el nuevo estado a alcanzar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl scale deployments jsonproducer --replicas=2
deployment.extensions/jsonproducer scaled

$ kubectl get pods
NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-2nzt2   1/1     Running   0          92m
jsonproducer-7769d76894-9xdqw   1/1     Running   0          18m</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueactualizaci-n-de-aplicaciones"><a class="anchor" href="#trueactualizaci-n-de-aplicaciones"></a>9. ActualizaciÃ³n de aplicaciones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para poder realizar actualizaciones sin tener que suspender el servicio mientras se realiza la actualizaciÃ³n, Kubernetes proporciona las <em>rolling updates</em>, que van actualizando los pods con la nueva versiÃ³n de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>De forma predeterminada, el nÃºmero de pods que pueden estar no disponibles durante una actualizaciÃ³n es 1, aunque esta opciÃ³n es configurable, ya sea mediante cantidad o porcentaje de pods no disponibles durante la actualizaciÃ³n. AdemÃ¡s, es posible volver a una versiÃ³n anterior.</p>
</div>
<div class="paragraph">
<p>Al igual que ocurre al escalar las aplicaciones, si el Despliegue estÃ¡ expuesto, el Servicio balancerÃ¡ el trÃ¡fico sÃ³lo a los pods que estÃ©n disponibles durante la actualizaciÃ³n.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n se muestra cÃ³mo actualizar el Deployment de ejemplo <code>jsonproducer</code> con nuevo Deployment con el mismo nombre y una versiÃ³n de la imagen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl set image deployments jsonproducer jsonproducer=ualmtorres/jsonproducer:v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Al realizar la actualizaciÃ³n de la imagen del Deployment, Kubernetes tendrÃ¡ que descargar la nueva imagen y organizar la creaciÃ³n de los pods en los nodos con recursos disponibles. Mientras se realiza la actualizaciÃ³n podremos ver que hay nodos que se estÃ¡n terminando, otros que se estÃ¡n creando y otros que estÃ¡n disponibles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME                            READY   STATUS              RESTARTS   AGE
jsonproducer-7769d76894-fr7cz   1/1     Running             0          25s
jsonproducer-7769d76894-hfpr7   1/1     Terminating         0          24s
jsonproducer-c76c87f-jwhxq      0/1     ContainerCreating   0          0s
jsonproducer-c76c87f-tmbkk      1/1     Running             0          1s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras unos instantes, la aplicaciÃ³n dejarÃ¡ de servir la versiÃ³n anterior de la aplicaciÃ³n y comenzarÃ¡ a servir la nueva versiÃ³n. La nueva versiÃ³n de la aplicaciÃ³n sirve <code>Manolo Torres</code> en lugar de <code>manolo</code> en el JSON.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesUpdateImage.png" alt="KubernetesUpdateImage.png">
</div>
</div>
<div class="paragraph">
<p>Para deshacer una actualizaciÃ³n de una aplicaciÃ³n volviendo a la versiÃ³n anterior haremos un <code>rollout undo</code>. El comando siguiente devuelve a la aplicaciÃ³n a la versiÃ³n anterior</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl rollout undo deployments jsonproducer
deployment.extensions/jsonproducer rolled back</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras este comando, el Controlador de Deployment de Kubernetes irÃ¡ reemplanzando los pods hasta alcanzar el estado deseado. A continuaciÃ³n se ve el estado intermedio mientras se vuelve a la versiÃ³n anterior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME                            READY   STATUS        RESTARTS   AGE
jsonproducer-7769d76894-m22sv   1/1     Running       0          2s
jsonproducer-7769d76894-v6hfv   1/1     Running       0          4s
jsonproducer-c76c87f-jwhxq      0/1     Terminating   0          14m
jsonproducer-c76c87f-tmbkk      0/1     Terminating   0          14m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras unos instantes, se alcanzarÃ¡ el estado deseado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Caligari:~ manolo$ kubectl get pods
NAME                            READY   STATUS    RESTARTS   AGE
jsonproducer-7769d76894-m22sv   1/1     Running   0          8s
jsonproducer-7769d76894-v6hfv   1/1     Running   0          10s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y la aplicaciÃ³n volverÃ¡ a mostrar el contenido anterior.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KubernetesRunningService.png" alt="KubernetesRunningService.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueap-ndice-cheat-sheet"><a class="anchor" href="#trueap-ndice-cheat-sheet"></a>10. ApÃ©ndice. Cheat Sheet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueminikube"><a class="anchor" href="#trueminikube"></a>10.1. Minikube</h3>
<div class="ulist">
<ul>
<li>
<p><code>minikube version</code></p>
</li>
<li>
<p><code>minikube start</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="true-code-kubectl-code"><a class="anchor" href="#true-code-kubectl-code"></a>10.2. <code>kubectl</code></h3>
<div class="ulist">
<ul>
<li>
<p><code>kubectl version</code></p>
</li>
<li>
<p><code>kubectl cluster-info</code></p>
</li>
<li>
<p><code>kubectl get nodes</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-07-16 18:31:36 CEST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>